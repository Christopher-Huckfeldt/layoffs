clear; clc; 
cd("/if/research-gms/Chris/layoffs/")
%% Load in Data

hazard_panel = readtable("hazard_panel.csv");
hazard_average = readtable("hazard.csv");
hazard_srefmonA = readtable("hazard_srefmonA.csv");

%% Plotting Figures

opt.rwkesr2 = {3,3,3,4,4,4}; % 3 or 4 
opt.prob_col = {'pR','pN','pE','pR','pN','pE'}; % pR, pN, pE
opt.tmp = {'Recall', 'New Job', 'Recall + New Job', 'Recall', 'New Job', '(Recall or New Job)'};
opt.lgnd = {0,0,0,0,0,1};
for ii=1:6
  opt.title_name{ii} = strcat("Probability of ",opt.tmp{ii});
end

figure('Position',[0 0 1900 900],'PaperPositionMode','Auto','DefaultAxesFontSize',17);
hold on;
clf;
for ii=1:6
subplot(2,3,ii)
figures.wave_probability_histogram(hazard_panel, hazard_average, opt.rwkesr2{ii}, opt.prob_col{ii}, opt.title_name{ii},opt.lgnd{ii})
end

annotation(gcf,'textbox',...
    [0.345906798245614 0.927597173144875 0.342114035087719 0.0724620996238462],...
    'Color',[0 0 1],...
    'String','Temporary Layoff',...
    'Interpreter','latex',...
    'HorizontalAlignment','center',...
    'FontSize',35,...
    'FontName','SansSerif',...
    'FitBoxToText','off', ...
    'EdgeColor','none');

annotation(gcf,'textbox',...
    [0.345906798245614 0.46303180212014 0.342114035087719 0.0686878934103377],...
    'Color',[0 0 1],...
    'String','Permanent Separation',...
    'Interpreter','latex',...
    'HorizontalAlignment','center',...
    'FontSize',35,...
    'FontName','SansSerif',...
    'FitBoxToText','off', ...
    'EdgeColor','none');

figure_property.units = 'inches';
figure_property.format = 'pdf';
figure_property.Preview= 'none';
figure_property.Width= '14'; % Figure width on canvas
figure_property.Height= '9'; % Figure height on canvas
figure_property.Units= 'inches';
figure_property.Color= 'rgb';
figure_property.Background= 'w';
figure_property.FixedfontSize= '12';
figure_property.ScaledfontSize= 'auto';
figure_property.FontMode= 'scaled';
figure_property.FontSizeMin= '12';
figure_property.FixedLineWidth= '1';
figure_property.ScaledLineWidth= 'auto';
figure_property.LineMode= 'none';
figure_property.LineWidthMin= '0.1';
figure_property.FontWeight= 'auto';
figure_property.FontAngle= 'auto';
figure_property.PSLevel= '3';
figure_property.Renderer= 'painters';
figure_property.Resolution= '600';
figure_property.LineStyleMap= 'none';
figure_property.ApplyStyle= '0';
figure_property.Bounds= 'tight';
figure_property.LockAxes= 'off';
figure_property.LockAxesTicks= 'off';
figure_property.ShowUI= 'off';
figure_property.SeparateText= 'off';

set(gcf,'PaperUnits','inches');
set(gcf,'PaperPositionMode','auto');
set(gcf, 'PaperOrientation', 'landscape')
set(gcf,'PaperSize',[str2num(figure_property.Width) str2num(figure_property.Height)]); % Canvas Size
set(gcf,'Units','inches');
hgexport(gcf,'figures/all.pdf',figure_property); %Set desired file name
% set(gcf, "PaperPosition", [0,0,1900,900])
% print('-dpdf', gcf, join(['figures/','all']));
%%
opt.srefmonA = {0,1,2,3,4,0,1,2,3,4,0,1,2,3,4}; % 3 or 4 
opt.prob_col = {'pE','pE','pE','pE','pE','pR','pR','pR','pR','pR','pN','pN','pN','pN','pN'}; % pE, pR, pN

figure('Position',[0 0 1900 900],'PaperPositionMode','Auto','DefaultAxesFontSize',17);
clf
for ii=1:15
  subplot (3,5,ii)
  figures.this(hazard_srefmonA,hazard_average, 3, opt.srefmonA{ii},opt.prob_col{ii}, '')  
  if (ii<=5)
    yL = [0,1.0];
    ylim(yL);
    yticks([0:.25:1])
  elseif (ii>5)
    yL = [0, 0.75]
    ylim(yL);
    yticks([0:.25:.75])
  end
  if (opt.srefmonA{ii}>0)
    line([5-opt.srefmonA{ii},5-opt.srefmonA{ii}],yL,'LineStyle',':','Color','Red','LineWidth',2)
    line([9-opt.srefmonA{ii},9-opt.srefmonA{ii}],yL,'LineStyle',':','Color','Red','LineWidth',2)
  end
end

figure_property.Width= '16'; % Figure width on canvas
figure_property.Height= '9'; % Figure height on canvas

annotation(gcf,'textbox',...
    [0.0506907894736846 0.801932367149755 0.0423419216136062 0.0502479158650757],...
    'Color',[0 0 1],...
    'String','to E',...
    'Interpreter','latex',...
    'HorizontalAlignment','center',...
    'FontSize',25,...
    'FontName','SansSerif',...
    'FitBoxToText','off',...
    'EdgeColor','none');

annotation(gcf,'textbox',...
    [0.0486074561403512 0.480676328502415 0.0423419216136062 0.0985570946090332],...
    'Color',[0 0 1],...
    'String','Recall to E',...
    'Interpreter','latex',...
    'HorizontalAlignment','center',...
    'FontSize',25,...
    'FontName','SansSerif',...
    'FitBoxToText','off',...
    'EdgeColor','none');

annotation(gcf,'textbox',...
    [0.0201666666666667 0.189613526570048 0.0958452110872907 0.0985570946090331],...
    'Color',[0 0 1],...
    'String',{'New hire','to E'},...
    'Interpreter','latex',...
    'HorizontalAlignment','center',...
    'FontSize',25,...
    'FontName','SansSerif',...
    'FitBoxToText','off',...
    'EdgeColor','none');

annotation(gcf,'textbox',...
    [0.169961622807018 0.933574879227049 0.0423419216136062 0.0502479158650759],...
    'Color',[0 0 1],...
    'String',{'All'},...
    'Interpreter','latex',...
    'HorizontalAlignment','center',...
    'FontSize',25,...
    'FontName','SansSerif',...
    'FitBoxToText','off',...
    'EdgeColor','none');

annotation(gcf,'textbox',...
    [0.303711622807018 0.938405797101447 0.1052467105263154 0.0502479158650757],...
    'Color',[0 0 1],...
    'String','1st month',...
    'Interpreter','latex',...
    'HorizontalAlignment','center',...
    'FontSize',25,...
    'FontName','SansSerif',...
    'FitBoxToText','off',...
    'EdgeColor','none');

annotation(gcf,'textbox',...
    [0.630208333333333 0.938405797101447 0.1053125 0.0502479158650759],...
    'Color',[0 0 1],...
    'String','3rd month',...
    'Interpreter','latex',...
    'HorizontalAlignment','center',...
    'FontSize',25,...
    'FontName','SansSerif',...
    'FitBoxToText','off',...
    'EdgeColor','none');

annotation(gcf,'textbox',...
    [0.472916666666667 0.938405797101447 0.095625 0.0502479158650757],...
    'Color',[0 0 1],...
    'String','2nd month',...
    'Interpreter','latex',...
    'HorizontalAlignment','center',...
    'FontSize',25,...
    'FontName','SansSerif',...
    'FitBoxToText','off',...
    'EdgeColor','none');

annotation(gcf,'textbox',...
    [0.788711622807017 0.938405797101447 0.107642543859649 0.0502479158650757],...
    'Color',[0 0 1],...
    'String','4th month',...
    'Interpreter','latex',...
    'HorizontalAlignment','center',...
    'FontSize',25,...
    'FontName','SansSerif',...
    'FitBoxToText','off',...
    'EdgeColor','none');

set(gcf,'PaperUnits','inches');
set(gcf,'PaperPositionMode','auto');
set(gcf, 'PaperOrientation', 'landscape')
set(gcf,'PaperSize',[str2num(figure_property.Width) str2num(figure_property.Height)]); % Canvas Size
set(gcf,'Units','inches');

hgexport(gcf,'figures/TL.pdf',figure_property); %Set desired file name
%%
figure('Position',[0 0 1500 600],'PaperPositionMode','Auto','DefaultAxesFontSize',17);
for ii=1:15
  subplot (3,5,ii)
  figures.this(hazard_srefmonA,hazard_average, 4, opt.srefmonA{ii},opt.prob_col{ii}, '')  
  if (ii<=5)
    yL = [0, 0.6]
    ylim(yL);
    yticks([0:.2:.6]);
  elseif (ii<=10)
    yL = [0, 0.10]
    ylim(yL);
    yticks([0:.02:.10]);
  else
    yL = [0, 0.6]
    ylim(yL);
    yticks([0:.2:.6]);
  end
  if (opt.srefmonA{ii}>0)
    line([5-opt.srefmonA{ii},5-opt.srefmonA{ii}],yL,'Color','Red','LineWidth',1)
    line([9-opt.srefmonA{ii},9-opt.srefmonA{ii}],yL,'Color','Red','LineWidth',1)
  end
  xticks([0:1:8]);
  xlim([0.5,8.5]);
end
print('-dpdf', gcf, join(['figures/','JL']));

figure('Position',[0 0 1900 900],'PaperPositionMode','Auto','DefaultAxesFontSize',17);
clf
for ii=1:15
  subplot (3,5,ii)
  figures.this(hazard_srefmonA,hazard_average, 4, opt.srefmonA{ii},opt.prob_col{ii}, '')  
  if (ii<=5)
    yL = [0,1.0];
    ylim(yL);
    yticks([0:.25:1])
  elseif (ii>5)
    yL = [0, 0.75]
    ylim(yL);
    yticks([0:.25:.75])
  end
  if (opt.srefmonA{ii}>0)
    line([5-opt.srefmonA{ii},5-opt.srefmonA{ii}],yL,'LineStyle',':','Color','Red','LineWidth',2)
    line([9-opt.srefmonA{ii},9-opt.srefmonA{ii}],yL,'LineStyle',':','Color','Red','LineWidth',2)
  end
end

figure_property.Width= '16'; % Figure width on canvas
figure_property.Height= '9'; % Figure height on canvas

annotation(gcf,'textbox',...
    [0.0506907894736846 0.801932367149755 0.0423419216136062 0.0502479158650757],...
    'Color',[0 0 1],...
    'String','to E',...
    'Interpreter','latex',...
    'HorizontalAlignment','center',...
    'FontSize',25,...
    'FontName','SansSerif',...
    'FitBoxToText','off',...
    'EdgeColor','none');

annotation(gcf,'textbox',...
    [0.0486074561403512 0.480676328502415 0.0423419216136062 0.0985570946090332],...
    'Color',[0 0 1],...
    'String','Recall to E',...
    'Interpreter','latex',...
    'HorizontalAlignment','center',...
    'FontSize',25,...
    'FontName','SansSerif',...
    'FitBoxToText','off',...
    'EdgeColor','none');

annotation(gcf,'textbox',...
    [0.0201666666666667 0.189613526570048 0.0958452110872907 0.0985570946090331],...
    'Color',[0 0 1],...
    'String',{'New hire','to E'},...
    'Interpreter','latex',...
    'HorizontalAlignment','center',...
    'FontSize',25,...
    'FontName','SansSerif',...
    'FitBoxToText','off',...
    'EdgeColor','none');

annotation(gcf,'textbox',...
    [0.169961622807018 0.933574879227049 0.0423419216136062 0.0502479158650759],...
    'Color',[0 0 1],...
    'String',{'All'},...
    'Interpreter','latex',...
    'HorizontalAlignment','center',...
    'FontSize',25,...
    'FontName','SansSerif',...
    'FitBoxToText','off',...
    'EdgeColor','none');

annotation(gcf,'textbox',...
    [0.303711622807018 0.938405797101447 0.1052467105263154 0.0502479158650757],...
    'Color',[0 0 1],...
    'String','1st month',...
    'Interpreter','latex',...
    'HorizontalAlignment','center',...
    'FontSize',25,...
    'FontName','SansSerif',...
    'FitBoxToText','off',...
    'EdgeColor','none');

annotation(gcf,'textbox',...
    [0.630208333333333 0.938405797101447 0.1053125 0.0502479158650759],...
    'Color',[0 0 1],...
    'String','3rd month',...
    'Interpreter','latex',...
    'HorizontalAlignment','center',...
    'FontSize',25,...
    'FontName','SansSerif',...
    'FitBoxToText','off',...
    'EdgeColor','none');

annotation(gcf,'textbox',...
    [0.472916666666667 0.938405797101447 0.095625 0.0502479158650757],...
    'Color',[0 0 1],...
    'String','2nd month',...
    'Interpreter','latex',...
    'HorizontalAlignment','center',...
    'FontSize',25,...
    'FontName','SansSerif',...
    'FitBoxToText','off',...
    'EdgeColor','none');

annotation(gcf,'textbox',...
    [0.788711622807017 0.938405797101447 0.107642543859649 0.0502479158650757],...
    'Color',[0 0 1],...
    'String','4th month',...
    'Interpreter','latex',...
    'HorizontalAlignment','center',...
    'FontSize',25,...
    'FontName','SansSerif',...
    'FitBoxToText','off',...
    'EdgeColor','none');

set(gcf,'PaperUnits','inches');
set(gcf,'PaperPositionMode','auto');
set(gcf, 'PaperOrientation', 'landscape')
set(gcf,'PaperSize',[str2num(figure_property.Width) str2num(figure_property.Height)]); % Canvas Size
set(gcf,'Units','inches');

hgexport(gcf,'figures/PS.pdf',figure_property); %Set desired file name
