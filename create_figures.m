clear; clc; 
close all;
%cd("/if/research-gms/Chris/layoffs/")
%% Load in Data

hazard_panel = readtable("hazard_panel.csv");
hazard_average = readtable("hazard.csv");
hazard_srefmonA = readtable("hazard_srefmonA.csv");

%% Plotting Figures

opt.rwkesr2 = {3,4,3,4,3,4}; % 3 or 4 
opt.prob_col = {'pR','pR','pN','pN','pE','pE'}; % pR, pN, pE
opt.lgnd = {0,0,0,0,0,1};
opt.title_name = {'A. Temporary layoff: Exit to recall', 'B.  Permanent Separation: Exit to recall', ... 
  'C. Temporary layoff: Exit to new job', 'D. Permanent separation: Exit to new job', ...
  'E. Temporary layoff: Exit to any employment', 'F. Permanent separation: Exit to any employment'};

figure('Position',[0 0 1000 1400],'PaperPositionMode','Auto','DefaultAxesFontSize',15);
hold on;
clf;
for ii=1:6
  subplot(3,2,ii)
  figures.wave_probability_histogram(hazard_panel, hazard_average, opt.rwkesr2{ii}, opt.prob_col{ii}, opt.title_name{ii},opt.lgnd{ii})
  if (ii<5)
    ylim([0,0.5])
  else
    ylim([0,0.7])
  end
end

figure_property.units = 'inches';
figure_property.format = 'pdf';
figure_property.Preview= 'none';
figure_property.Width= '9'; % Figure height on canvas
figure_property.Height= '11'; % Figure width on canvas
figure_property.Units= 'inches';
figure_property.Color= 'rgb';
figure_property.Background= 'w';
figure_property.FixedfontSize= '12';
figure_property.ScaledfontSize= 'auto';
figure_property.FontMode= 'scaled';
figure_property.FontSizeMin= '12';
figure_property.FixedLineWidth= '1';
figure_property.ScaledLineWidth= 'auto';
figure_property.LineMode= 'none';
figure_property.LineWidthMin= '0.1';
figure_property.FontWeight= 'auto';
figure_property.FontAngle= 'auto';
figure_property.PSLevel= '3';
figure_property.Renderer= 'painters';
figure_property.Resolution= '600';
figure_property.LineStyleMap= 'none';
figure_property.ApplyStyle= '0';
figure_property.Bounds= 'tight';
figure_property.LockAxes= 'off';
figure_property.LockAxesTicks= 'off';
figure_property.ShowUI= 'off';
figure_property.SeparateText= 'off';

set(gcf,'PaperUnits','inches');
set(gcf,'PaperPositionMode','auto');
set(gcf, 'PaperOrientation', 'portrait')
set(gcf,'PaperSize',[str2num(figure_property.Width) str2num(figure_property.Height)]); % Canvas Size
set(gcf,'Units','inches');
hgexport(gcf,'figures/exit_hazards.pdf',figure_property); %Set desired file name
% set(gcf, "PaperPosition", [0,0,1900,900])
% print('-dpdf', gcf, join(['figures/','all']));
%%

opt.rwkesr2 = {3,3,3,4,4,4}; % 3 or 4 
opt.prob_col = {'pR','pN','pE','pR','pN','pE'}; % pR, pN, pE
opt.lgnd = {0,0,0,0,0,1};
opt.title_name = {'(A) TL: Exit to recall', '(B) TL: Exit to any employment', ... 
  '(C) TL: Exit to new job', '(D) PS: Exit to recall', '(E) PS: Exit to new job', ...
  '(F) PS: Exit to any employment'};

figure('Position',[0 0 1400 1000],'PaperPositionMode','Auto','DefaultAxesFontSize',15);
hold on;
clf;
for ii=1:6
  subplot(2,3,ii)
  figures.wave_probability_histogram(hazard_panel, hazard_average, opt.rwkesr2{ii}, opt.prob_col{ii}, opt.title_name{ii},opt.lgnd{ii})
  if (ii==1 | ii==2 | ii==4 | ii==5)
    ylim([0,0.5])
  else
    ylim([0,0.7])
  end
end

figure_property.units = 'inches';
figure_property.format = 'pdf';
figure_property.Preview= 'none';
figure_property.Width= '11'; % Figure height on canvas
figure_property.Height= '9'; % Figure width on canvas
figure_property.Units= 'inches';
figure_property.Color= 'rgb';
figure_property.Background= 'w';
figure_property.FixedfontSize= '12';
figure_property.ScaledfontSize= 'auto';
figure_property.FontMode= 'scaled';
figure_property.FontSizeMin= '12';
figure_property.FixedLineWidth= '1';
figure_property.ScaledLineWidth= 'auto';
figure_property.LineMode= 'none';
figure_property.LineWidthMin= '0.1';
figure_property.FontWeight= 'auto';
figure_property.FontAngle= 'auto';
figure_property.PSLevel= '3';
figure_property.Renderer= 'painters';
figure_property.Resolution= '600';
figure_property.LineStyleMap= 'none';
figure_property.ApplyStyle= '0';
figure_property.Bounds= 'tight';
figure_property.LockAxes= 'off';
figure_property.LockAxesTicks= 'off';
figure_property.ShowUI= 'off';
figure_property.SeparateText= 'off';

set(gcf,'PaperUnits','inches');
set(gcf,'PaperPositionMode','auto');
set(gcf, 'PaperOrientation', 'landscape')
set(gcf,'PaperSize',[str2num(figure_property.Width) str2num(figure_property.Height)]); % Canvas Size
set(gcf,'Units','inches');
hgexport(gcf,'figures/exit_hazards_landscape.pdf',figure_property); %Set desired file name


%%%

opt.srefmonA = {0,1,2,3,4,0,1,2,3,4,0,1,2,3,4}; % 3 or 4 
opt.prob_col = {'pR','pR','pR','pR','pR','pN','pN','pN','pN','pN','pE','pE','pE','pE','pE'}; % pE, pR, pN

figure('Position',[0 0 1900 900],'PaperPositionMode','Auto','DefaultAxesFontSize',17);
clf
for ii=1:15
  subplot (3,5,ii)
  figures.this(hazard_srefmonA,hazard_average, 3, opt.srefmonA{ii},opt.prob_col{ii}, '')  
  if (ii<=5)
    yL = [0, 0.8]
    ylim(yL);
    yticks([0:.2:.8])
  elseif (ii>5 & ii<11)
    yL = [0,0.6];
    ylim(yL);
    yticks([0:.2:.6])
  else
    yL = [0, 1.00]
    ylim(yL);
    yticks([0:.25:1.0])
  end
  if (opt.srefmonA{ii}>0)
    line([5-opt.srefmonA{ii},5-opt.srefmonA{ii}],yL,'LineStyle',':','Color','Red','LineWidth',2)
    line([9-opt.srefmonA{ii},9-opt.srefmonA{ii}],yL,'LineStyle',':','Color','Red','LineWidth',2)
  end
end

figure_property.Width= '16'; % Figure width on canvas
figure_property.Height= '9'; % Figure height on canvas

annotation(gcf,'textbox',...
    [0.0464802631578952 0.808888888888889 0.0540460526315786 0.0299580607926083],...
    'String',{'Recalls'},...
    'Interpreter','latex',...
    'HorizontalAlignment','center',...
    'FontSize',17,...
    'FontName','SansSerif',...
    'FitBoxToText','off',...
    'EdgeColor','none');

annotation(gcf,'textbox',...
    [0.0389473684210528 0.5 0.06421052631579 0.0325667564447814],...
    'String',{'New jobs'},...
    'Interpreter','latex',...
    'HorizontalAlignment','center',...
    'FontSize',17,...
    'FontName','SansSerif',...
    'FitBoxToText','off',...
    'EdgeColor','none');

annotation(gcf,'textbox',...
    [0.0394736842105264 0.21 0.063684210526316 0.0359483989568587],...
    'String',{'Recalls','+ New jobs'},...
    'Interpreter','latex',...
    'HorizontalAlignment','center',...
    'FontSize',17,...
    'FontName','SansSerif',...
    'FitBoxToText','off',...
    'EdgeColor','none');


annotation(gcf,'textbox',...
    [0.172593201754387 0.933333333333333 0.0321436403508768 0.0293783506476805],...
    'String',{'All'},...
    'Interpreter','latex',...
    'HorizontalAlignment','center',...
    'FontSize',17,...
    'FontName','SansSerif',...
    'FitBoxToText','off',...
    'EdgeColor','none');

annotation(gcf,'textbox',...
    [0.303711622807018 0.925072463768114 0.105246710526315 0.0502479158650757],...
    'String',{'1st reference','month'},...
    'Interpreter','latex',...
    'HorizontalAlignment','center',...
    'FontSize',17,...
    'FontName','SansSerif',...
    'FitBoxToText','off',...
    'EdgeColor','none');

annotation(gcf,'textbox',...
    [0.456842105263158 0.927294685990336 0.121578947368421 0.0502479158650757],...
    'String',{'2nd reference','month'},...
    'Interpreter','latex',...
    'HorizontalAlignment','center',...
    'FontSize',17,...
    'FontName','SansSerif',...
    'FitBoxToText','off',...
    'EdgeColor','none');

% Create textbox
annotation(gcf,'textbox',...
    [0.619473684210526 0.927294685990336 0.123157894736842 0.0502479158650759],...
    'String',{'3rd reference','month'},...
    'Interpreter','latex',...
    'HorizontalAlignment','center',...
    'FontSize',17,...
    'FontName','SansSerif',...
    'FitBoxToText','off',...
    'EdgeColor','none');

% Create textbox
annotation(gcf,'textbox',...
    [0.782105263157896 0.927294685990336 0.122631578947369 0.0502479158650757],...
    'String',{'4th reference','month'},...
    'Interpreter','latex',...
    'HorizontalAlignment','center',...
    'FontSize',17,...
    'FontName','SansSerif',...
    'FitBoxToText','off',...
    'EdgeColor','none');

set(gcf,'PaperUnits','inches');
set(gcf,'PaperPositionMode','auto');
set(gcf, 'PaperOrientation', 'landscape')
set(gcf,'PaperSize',[str2num(figure_property.Width) str2num(figure_property.Height)]); % Canvas Size
set(gcf,'Units','inches');

hgexport(gcf,'figures/TL.pdf',figure_property); %Set desired file name
%%


figure('Position',[0 0 1900 900],'PaperPositionMode','Auto','DefaultAxesFontSize',17);
clf
for ii=1:15
  subplot (3,5,ii)
  figures.this(hazard_srefmonA,hazard_average, 4, opt.srefmonA{ii},opt.prob_col{ii}, '')  
  if (ii<=5)
    yL = [0,0.08]
    ylim(yL);
    yticks([0:.02:.08])
  elseif (ii>5 & ii<11)
    yL = [0,0.75];
    ylim(yL);
    yticks([0:.25:1])
  else
    yL = [0, 0.6]
    ylim(yL);
    yticks([0:.15:.6])
  end
  if (opt.srefmonA{ii}>0)
    line([5-opt.srefmonA{ii},5-opt.srefmonA{ii}],yL,'LineStyle',':','Color','Red','LineWidth',2)
    line([9-opt.srefmonA{ii},9-opt.srefmonA{ii}],yL,'LineStyle',':','Color','Red','LineWidth',2)
  end
end

figure_property.Width= '16'; % Figure width on canvas
figure_property.Height= '9'; % Figure height on canvas


annotation(gcf,'textbox',...
    [0.0464802631578952 0.808888888888889 0.0540460526315786 0.0299580607926083],...
    'String',{'Recalls'},...
    'Interpreter','latex',...
    'HorizontalAlignment','center',...
    'FontSize',17,...
    'FontName','SansSerif',...
    'FitBoxToText','off',...
    'EdgeColor','none');

annotation(gcf,'textbox',...
    [0.0389473684210528 0.5 0.06421052631579 0.0325667564447814],...
    'String',{'New jobs'},...
    'Interpreter','latex',...
    'HorizontalAlignment','center',...
    'FontSize',17,...
    'FontName','SansSerif',...
    'FitBoxToText','off',...
    'EdgeColor','none');

annotation(gcf,'textbox',...
    [0.0394736842105264 0.21 0.063684210526316 0.0359483989568587],...
    'String',{'Recalls','+ New jobs'},...
    'Interpreter','latex',...
    'HorizontalAlignment','center',...
    'FontSize',17,...
    'FontName','SansSerif',...
    'FitBoxToText','off',...
    'EdgeColor','none');

annotation(gcf,'textbox',...
    [0.172593201754387 0.933333333333333 0.0321436403508768 0.0293783506476805],...
    'String',{'All'},...
    'Interpreter','latex',...
    'HorizontalAlignment','center',...
    'FontSize',17,...
    'FontName','SansSerif',...
    'FitBoxToText','off',...
    'EdgeColor','none');

annotation(gcf,'textbox',...
    [0.303711622807018 0.925072463768114 0.105246710526315 0.0502479158650757],...
    'String',{'1st reference','month'},...
    'Interpreter','latex',...
    'HorizontalAlignment','center',...
    'FontSize',17,...
    'FontName','SansSerif',...
    'FitBoxToText','off',...
    'EdgeColor','none');

annotation(gcf,'textbox',...
    [0.456842105263158 0.927294685990336 0.121578947368421 0.0502479158650757],...
    'String',{'2nd reference','month'},...
    'Interpreter','latex',...
    'HorizontalAlignment','center',...
    'FontSize',17,...
    'FontName','SansSerif',...
    'FitBoxToText','off',...
    'EdgeColor','none');

% Create textbox
annotation(gcf,'textbox',...
    [0.619473684210526 0.927294685990336 0.123157894736842 0.0502479158650759],...
    'String',{'3rd reference','month'},...
    'Interpreter','latex',...
    'HorizontalAlignment','center',...
    'FontSize',17,...
    'FontName','SansSerif',...
    'FitBoxToText','off',...
    'EdgeColor','none');

% Create textbox
annotation(gcf,'textbox',...
    [0.782105263157896 0.927294685990336 0.122631578947369 0.0502479158650757],...
    'String',{'4th reference','month'},...
    'Interpreter','latex',...
    'HorizontalAlignment','center',...
    'FontSize',17,...
    'FontName','SansSerif',...
    'FitBoxToText','off',...
    'EdgeColor','none');


set(gcf,'PaperUnits','inches');
set(gcf,'PaperPositionMode','auto');
set(gcf, 'PaperOrientation', 'landscape')
set(gcf,'PaperSize',[str2num(figure_property.Width) str2num(figure_property.Height)]); % Canvas Size
set(gcf,'Units','inches');

hgexport(gcf,'figures/PS.pdf',figure_property); %Set desired file name
